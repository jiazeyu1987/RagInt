# 系统详细设计（从系统需求拆解）

> 说明：本文严格从 `doc/robot/系统需求文档.md` 拆解而来，按 SR 编号逐条落到可执行的设计与交付要求。本文不描述软件内部实现，也不定义软件接口协议；仅说明第三方需要提供的硬件/物料/场地准备与“对接能力”。

## 1. 需求对齐（SR → DD）

| 系统需求（SR） | 对应详细设计条目（DD） |
|---|---|
| SR-1 场景与范围 | DD-1、DD-4、DD-10 |
| SR-2 站点与路线 | DD-4、DD-5、DD-11 |
| SR-3 移动与到站能力 | DD-5、DD-6、DD-11 |
| SR-4 安全与人机提示 | DD-6、DD-7、DD-11 |
| SR-5 语音输入 | DD-8、DD-11 |
| SR-6 语音输出 | DD-8、DD-11 |
| SR-7 计算与系统环境 | DD-2、DD-9、DD-11 |
| SR-8 网络与外部依赖 | DD-3、DD-9、DD-10 |
| SR-9 运维与可观测性 | DD-9、DD-11 |
| SR-10 容错与降级 | DD-10、DD-11 |
| SR-11 数据与隐私 | DD-9、DD-10 |
| SR-12 交付物与文档 | DD-11 |
| SR-13 实施计划与人力投入 | DD-12 |

## DD-1 场景与范围落地（对应 SR-1）

- 场地假设：单房间、路线固定；站点数量建议 3~10 个。
- 交付关注点：稳定“到站→讲解”，并支持“打断→停止移动/停止播报→问答→恢复”。
- 不做项落实：不做自主建图/复杂重定位；不做人脸/身份识别；不引入多语种/大屏联动/统计分析。

## DD-2 硬件与物料清单（BOM，SR-7/SR-4/SR-5/SR-6）

> 型号可替换，但关键指标必须满足。集成方交付时需提交：型号清单、参数表、接线图、保修与维护信息。

### DD-2.1 必选物料（P0）

| 模块 | 数量 | 关键指标（必须满足） | 备注 |
|---|---:|---|---|
| 室内移动底盘 | 1 | 支持室内点位到达；具备避障/碰撞保护；支持急停；可提供移动状态 | 底盘能力决定“到站是否可靠” |
| 工控机/主机 | 1 | 可运行控制界面与业务服务；建议 x86_64、≥8GB 内存、≥256GB SSD；USB+网口齐全 | Windows/Linux 均可 |
| 麦克风 | 1 | 语音采集稳定；建议 AEC/降噪；可统一到 16k mono | USB 麦克风/阵列均可 |
| 扬声器/功放 | 1 | 音量足够、失真低；连续播报稳定 | 无源需配功放 |
| 物理急停（E‑Stop） | 1 | 触发后立即停止移动并进入安全状态 | 底盘自带优先 |
| 指示灯或小屏 | 1 | 至少可显示：移动/讲解/听取/异常 | 3 色灯或小屏均可 |
| 电池与充电 | 1 | 续航建议 ≥4h；低电量提示；安全充电方案 | 自动回充可选 |
| 网络 | 1 | 有线或稳定 Wi‑Fi；与底盘同网段可通信 | 建议保留有线口 |

### DD-2.2 可选物料

| 模块 | 数量 | 用途 |
|---|---:|---|
| 扩声音箱 | 1 | 嘈杂环境提升可听性 |
| 充电桩（自动回充） | 1 | 长时间无人值守运行 |
| 避障传感器补强 | 1 | 人群密集/通道窄时加强安全 |

### DD-2.3 辅料与安装件（必须齐全）

- 线材：网线、USB 延长线（带屏蔽）、音频线（若外接功放/音箱）、电源线与理线耗材
- 固定件：工控机支架、麦克风支架/减震垫、扬声器支架
- 现场标识：站点标识牌/地贴（引导参观者与现场复核）

## DD-3 网络、供电与布线（对应 SR-8/SR-7）

### DD-3.1 网络拓扑与地址规划

- 工控机与底盘控制器建议同一网段（便于稳定通信）。
- 现场优先有线；Wi‑Fi 作为补充；调试阶段建议预留网口直连。
- 若需要访问外部服务（知识库/ASR/TTS），建议走内网转发或本机部署，减少公网不确定性。

### DD-3.2 供电与安全

- 电池续航满足单场次运行（建议 ≥4h）；低电量需提示并可进入安全停靠流程。
- 充电方式（人工/自动回充）需明确；充电时机器人应禁止自动移动（防止拉线风险）。

### DD-3.3 布线与固定

- 线缆走线需避开移动部件，使用扎带/线槽固定，避免行走时被绊住或拉扯。
- 麦克风与扬声器安装位置需避开相互直吹，减少回声与啸叫。

## DD-4 站点与路线设计（对应 SR-2/SR-1）

### DD-4.1 站点定义

每个站点需提供一份站点清单（交付文档），至少包含：
- 站点名称（中文，展示使用）
- 站点 ID（稳定英文/数字，配置使用）
- 底盘目标点（坐标/命名点位/二维码点位等，形式由底盘决定）
- 站点讲解时长（秒）
- 到站标准（由底盘状态提供为主；可补充现场“到站复核规则”）

### DD-4.2 站点标定流程（第三方必须给出可执行步骤）

第三方需给出可执行的“站点标定步骤”，包含：
- 如何让底盘进入标定模式
- 如何记录/保存站点点位（以及如何导出/备份）
- 如何验证站点（多次往返到站一致性）
- 标定失败的排查步骤（网络/地图/传感器/轮胎打滑等）

## DD-5 移动与到站对接能力（对应 SR-3/SR-2）

> 本节不规定通信协议，但规定第三方必须向业务侧提供的能力与语义。

### DD-5.1 必须具备的控制能力（最小闭环）

- 按站点前往：输入站点 ID 或目标点，开始移动
- 取消移动：可被随时取消（尤其在“打断/急停/人工介入”场景）
- 状态查询：可查询当前状态与目标站点

### DD-5.2 状态语义（必须可对外表达）

移动状态至少包含：
- `idle`：空闲
- `moving`：移动中
- `arrived`：已到站
- `failed`：失败（含不可达/超时/障碍持续阻塞）
- `cancelled`：已取消
- `estop`：急停触发

失败必须提供原因（至少可区分：不可达/超时/急停/障碍阻塞），便于运维定位。

### DD-5.3 到站标准与超时

- 到站标准以底盘给出的到站状态为准。
- 每次移动应有超时机制（由第三方或业务侧配置），超时进入失败并停止移动。

## DD-6 安全策略与人机提示（对应 SR-4）

### DD-6.1 物理急停

- 必须具备物理急停按钮（E‑Stop），急停触发后底盘立即停止并进入锁定状态。
- 急停解除后的恢复流程需明确（例如：人工复位→系统回到空闲→允许重新发起移动）。

### DD-6.2 室内限速与避障

- 室内运行需限速/限加速度；通道窄或人群密集可降速。
- 避障/防撞为底盘必须能力；在障碍持续阻塞时应停止并上报失败，避免“顶着不走”。

### DD-6.3 指示灯/小屏提示规范

至少支持以下状态提示（灯色/文案由第三方实现）：
- 移动中
- 讲解中
- 听取中（录音/识别中）
- 异常（移动失败/外部服务不可用/急停）

## DD-7 计算与运行环境（对应 SR-7）

- 工控机需支持开机自启（Windows 服务或 systemd 任选），并提供配置与操作手册。
- 建议提供“一键检查脚本/工具”，输出：CPU/内存/磁盘、网络连通、音频设备识别、底盘连通状态。

## DD-8 音频链路设计（对应 SR-5/SR-6）

### DD-8.1 语音输入链路

- 麦克风采集应稳定，建议 AEC/降噪；采样率统一到 16k mono（或能稳定转换）。
- 第三方需保证硬件与系统权限支持软件侧完成录音/识别/打断，以及“手动输入兜底”的操作路径。

### DD-8.2 语音输出链路

- 扬声器音量满足现场；避免明显失真、破音、底噪。
- 播放需要支持快速中断；第三方需确保音频设备与驱动在高频启停时稳定（不崩溃/不白噪音）。

## DD-9 运维、日志与数据（对应 SR-9/SR-11）

### DD-9.1 状态可视与导出

- 运行状态需可查看并可导出（例如：最近 N 次会话/任务的关键事件与耗时；具体字段与接口由软件文档定义）。
- 日志需包含：会话/任务标识、站点、移动目标、取消原因、失败原因；便于复盘现场问题。

### DD-9.2 数据最小化与清理

- 默认不保存原始音频；仅保存必要的文本、时间戳、请求标识与少量运行日志。
- 提供日志与历史的清理机制（按天数或容量），并在交付文档中写明默认策略。

## DD-10 容错与降级实现要求（对应 SR-10/SR-8/SR-1）

- 外部服务不可用时，系统需具备离线讲解资源包（预录音音频文件与清单/索引），确保软件侧可启用离线讲解，保证基本参观流程不中断。
- 可选/后续：本地脚本文本兜底资源（按站点准备简短讲解文本）。
- 移动失败时停止并提示人工协助；不得进入“假到站讲解”。

## DD-11 交付物与验收（对应 SR-12，覆盖全链路）

### DD-11.1 第三方交付物清单（必须）

- BOM 清单（含型号/数量/参数/供应信息）与接线图
- 站点清单与标定步骤（含导出/备份方法）
- 开机自启与部署手册（含常见故障排查）
- 维护手册（急停、充电、人工接管、恢复流程）
- 离线讲解资源包（预录音音频文件与清单/索引），保证外部服务不可用时仍可按站点讲解
- 现场验收检查表（可打印执行）

### DD-11.2 现场验收最小集（建议）

- 站点到达：从任意站点到任意站点可达（抽测 ≥3 个站点往返），到站判定稳定
- 打断：在移动/播报过程中触发打断，移动与播报均能停止并可恢复
- 降级：断开外部服务后，离线讲解资源包可用，可触发离线讲解并可停止/退出
- 安全：急停有效；解除急停后可按流程恢复

## DD-12 实施计划与人力投入（对应 SR-13）

> 目的：给预算与排期提供“可解释”的依据。人力按人月估算，实际以现场站点数量、底盘接口成熟度、外部服务部署方式为准。

### DD-12.1 阶段划分（建议）

| 阶段 | 覆盖的 DD 条目 | 主要工作内容 | 主要交付物 | 建议人月（合计） |
|---|---|---|---|---:|
| P1 方案确认与踏勘 | DD-1、DD-3、DD-4 | 场地踏勘、站点初稿、网络/供电方案、风险点确认 | 场地信息与站点清单初稿、实施计划、风险清单 | 0.5 |
| P2 硬件选型与集成 | DD-2、DD-3、DD-6、DD-8 | 底盘/音频/主机选型采购、安装布线、急停/指示灯接入、基础联通 | BOM、接线图、硬件安装完成 | 2.0 |
| P3 站点标定与移动闭环 | DD-4、DD-5、DD-6 | 站点标定、到站标准确认、移动状态语义对齐、失败场景处理 | 站点标定文档、到站验证记录、移动闭环可用 | 2.0 |
| P4 音频与现场体验调优 | DD-8、DD-6 | 麦克风/扬声器位置调整、回声/啸叫排查、打断稳定性验证 | 音频调试记录、体验优化清单 | 1.0 |
| P5 运维与验收交付 | DD-9、DD-10、DD-11、DD-7 | 日志/导出/清理策略落实、降级演练、验收测试与文档收口 | 运维手册、验收检查表、交付包 | 1.5 |
|  |  |  | **合计** | **7.0** |

### DD-12.2 角色建议（示例）

| 角色 | 主要职责 | 建议投入（人月） |
|---|---|---:|
| 系统集成工程师 | 硬件集成、网络/供电、站点标定与联调推进 | 3.0 |
| 现场实施工程师 | 安装布线、现场调试、故障排查、验收支持 | 2.0 |
| 测试/运维工程师 | 验收用例执行、日志与可观测、降级演练与手册 | 1.0 |
| 项目协调/交付 | 计划与里程碑推进、文档收口、风险闭环 | 1.0 |
|  |  | **7.0** |
