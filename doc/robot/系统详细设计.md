# 系统详细设计

> 说明：本文严格从 `doc/robot/系统需求文档.md` 拆解而来，按 SR 编号逐条落到可执行的设计与交付要求。本文不描述软件内部实现，也不定义软件接口协议；仅说明第三方需要提供的硬件/物料/场地准备与“对接能力”。

## 1. 需求对齐（SR → DD）

| 系统需求（SR） | 对应详细设计条目（DD） |
|---|---|
| SR-1 场景与范围 | DD-1、DD-5、DD-11 |
| SR-2 站点与路线 | DD-5、DD-6、DD-12 |
| SR-3 移动与到站能力 | DD-6、DD-7、DD-12 |
| SR-4 安全与人机提示 | DD-7、DD-8、DD-12 |
| SR-5 语音输入 | DD-9、DD-12 |
| SR-6 语音输出 | DD-9、DD-12 |
| SR-7 计算与系统环境 | DD-2、DD-10、DD-12 |
| SR-8 结构与安装（机械结构） | DD-3 |
| SR-9 工业设计（结构与功能工业设计） | DD-3 |
| SR-10 网络与外部依赖 | DD-4、DD-10、DD-11 |
| SR-11 运维与可观测性 | DD-10、DD-12 |
| SR-12 容错与降级 | DD-11、DD-12 |
| SR-13 数据与隐私 | DD-10、DD-11 |
| SR-14 交付物与文档 | DD-12 |
| SR-15 实施计划与人力投入 | DD-13 |

## DD-1 场景与范围落地（对应 SR-1）

- 场地假设：单房间、路线固定；站点数量建议 3~10 个。
- 交付关注点：稳定“到站→讲解”，并支持“打断→停止移动/停止播报→问答→恢复”。
- 不做项落实：不做自主建图/复杂重定位；不做人脸/身份识别；不引入多语种/大屏联动/统计分析。

## DD-2 硬件与物料清单（BOM，SR-7/SR-4/SR-5/SR-6）

> 型号可替换，但关键指标必须满足。集成方交付时需提交：型号清单、参数表、接线图、保修与维护信息。

### DD-2.1 必选物料（P0）

| 模块 | 数量 | 关键指标（必须满足） | 备注 |
|---|---:|---|---|
| 室内移动底盘 | 1 | 支持室内点位到达；具备避障/碰撞保护；支持急停；可提供移动状态 | 底盘能力决定“到站是否可靠” |
| 工控机/主机 | 1 | 可运行控制界面与业务服务；建议 x86_64、≥8GB 内存、≥256GB SSD；USB+网口齐全 | Windows/Linux 均可 |
| 麦克风 | 1 | 语音采集稳定；建议 AEC/降噪；可统一到 16k mono | USB 麦克风/阵列均可 |
| 扬声器/功放 | 1 | 音量足够、失真低；连续播报稳定 | 无源需配功放 |
| 物理急停（E‑Stop） | 1 | 触发后立即停止移动并进入安全状态 | 底盘自带优先 |
| 指示灯或小屏 | 1 | 至少可显示：移动/讲解/听取/异常 | 3 色灯或小屏均可 |
| 电池与充电 | 1 | 续航建议 ≥4h；低电量提示；安全充电方案 | 自动回充可选 |
| 网络 | 1 | 有线或稳定 Wi‑Fi；与底盘同网段可通信 | 建议保留有线口 |

### DD-2.2 可选物料

| 模块 | 数量 | 用途 |
|---|---:|---|
| 扩声音箱 | 1 | 嘈杂环境提升可听性 |
| 充电桩（自动回充） | 1 | 长时间无人值守运行 |
| 避障传感器补强 | 1 | 人群密集/通道窄时加强安全 |

### DD-2.3 辅料与安装件

- 线材：网线、USB 延长线（带屏蔽）、音频线（若外接功放/音箱）、电源线与理线耗材
- 固定件：工控机支架、麦克风支架/减震垫、扬声器支架
- 结构件：安装底板/支架、线缆固定与应力释放件、必要的外壳/防护罩（若底盘本体不含上装结构）
- 现场标识：站点标识牌/地贴（引导参观者与现场复核）

## DD-3 工业设计（结构与功能工业设计，对应 SR-8/SR-9）

> 说明：
> - 本节按“需求描述/技术指标/实现方式/实现原理/物料预算”的方式展开，风格参考 `AI展厅机器人需求与实现方式.docx`。
> - 本节覆盖“外观/结构/功能布局/安装与维护/走线与防护”等工业设计内容，目标是能交付、能安装、可验收。
> - 不引入 SR-1 明确排除的扩展部件（触摸大屏、摄像头/RGB-D 等），除非需求另行明确。

### DD-3.1 工业设计需求对应表

| 需求描述 | 技术指标（建议验收口径） | 实现方式（具体硬件/工艺） | 实现原理 | 物料预算（参考） | 备注 |
|---|---|---|---|---:|---|
| 外观与品牌一致性 | 外观统一、便于清洁；标识位预留；说明贴/导视清晰 | 工业设计外观方案（配色/材质/贴纸/标牌）；可更换面板/贴纸 | 通过统一视觉语言与导视提升展厅一致性与可用性 | 200~800 | 以贴纸/标牌为主，避免大幅改造底盘本体 |
| 外壳打样（小批试制） | 1~2 套外壳打样可装配；外观与安装位一致；打样后可用于现场展示/验收 | 3D 打印/真空复模/钣金打样（喷涂/丝印）；关键安装位实测校核 | 通过低批量试制验证外观、装配、维护开口与走线合理性，降低量产风险 | 30000 | 适用于仅做 1~2 套；若开模量产需另行报价 |
| 外观与基础防护（结构） | 外露尖角为 0；边角倒圆/包边；可遮挡内部线束与电气 | ABS/PC 外壳或钣金罩壳；边缘包胶；检修门（带锁扣） | 通过包边与罩壳隔离尖角与电气，降低刮碰与误触风险 | 1500~4000 | 若底盘自带上装外壳，可仅做补强 |
| 功能布局与人因（可达/可见） | 急停按钮可达；状态指示在主要视角可见；接口/维护开口可达 | E-Stop 外置或引出；指示灯/小屏上置；接口面板集中布置；关键位置标识 | 降低紧急操作与日常维护的路径成本，减少误操作 | 200~800 | 与 DD-7.3 的提示规范一致 |
| 稳定性与抗倾倒 | 正常运行与急停/轻推下不易倾倒；部件安装后重心可控 | 重件（电池/工控机）下置；立柱与底座加固；必要时加配重块/防倾支撑 | 通过降低重心与增大支撑面，提高静/动态稳定裕度 | 0~1500 | 具体取决于底盘结构与载荷余量 |
| 安装与可维护性 | 常用维护可在 ≤10 分钟完成（开盖/换线/更换模块） | 模块化安装底板（铝型材/钢板）；快拆螺丝/手拧件；预留检修开口 | 通过模块化与快拆减少拆装路径，降低维护时间与误装风险 | 500~2000 | 交付需给出拆装步骤与工具清单 |
| 线缆管理与应力释放 | 线束固定、无拖地；连接器不易松脱；关键线有应力释放 | 线槽/波纹管/编织网管；扎带座；理线夹；电源线/USB/音频线分区走线 | 固定与分区走线降低磨损/缠绕与电磁串扰概率，避免行走拉扯 | 200~800 | 与 DD-4.3 “布线与固定”一致 |
| 散热与噪声控制（上装） | 设备表面不过热；风扇噪声不影响讲解（室内可接受） | 预留进出风通道；防尘网；必要时低噪风扇（含防护罩） | 保证换气通道，降低热堆积；防尘网便于清洁维护 | 0~600 | 若工控机为无风扇方案可为 0 |
| 走线与接口可达性 | USB/网口/电源插拔便利；关键接口可标识 | 接口面板集中布置；线束标签；防呆/防反插 | 通过集中接口与标识降低现场误插误拔概率 | 100~500 | 与交付文档要求配套 |

## DD-4 网络、供电与布线（对应 SR-10/SR-7）

### DD-4.1 网络拓扑与地址规划

- 工控机与底盘控制器建议同一网段（便于稳定通信）。
- 现场优先有线；Wi‑Fi 作为补充；调试阶段建议预留网口直连。
- 若需要访问外部服务（知识库/ASR/TTS），建议走内网转发或本机部署，减少公网不确定性。

### DD-4.2 供电与安全

- 电池续航满足单场次运行（建议 ≥4h）；低电量需提示并可进入安全停靠流程。
- 充电方式（人工/自动回充）需明确；充电时机器人应禁止自动移动（防止拉线风险）。

### DD-4.3 布线与固定

- 线缆走线需避开移动部件，使用扎带/线槽固定，避免行走时被绊住或拉扯。
- 麦克风与扬声器安装位置需避开相互直吹，减少回声与啸叫。

## DD-5 站点与路线设计（对应 SR-2/SR-1）

### DD-5.1 站点定义

每个站点需提供一份站点清单（交付文档），至少包含：
- 站点名称（中文，展示使用）
- 站点 ID（稳定英文/数字，配置使用）
- 底盘目标点（坐标/命名点位/二维码点位等，形式由底盘决定）
- 站点讲解时长（秒）
- 到站标准（由底盘状态提供为主；可补充现场“到站复核规则”）

### DD-5.2 站点标定流程

第三方需给出可执行的“站点标定步骤”，包含：
- 如何让底盘进入标定模式
- 如何记录/保存站点点位（以及如何导出/备份）
- 如何验证站点（多次往返到站一致性）
- 标定失败的排查步骤（网络/地图/传感器/轮胎打滑等）

## DD-6 移动与到站对接能力（对应 SR-3/SR-2）

> 本节不规定通信协议，但规定第三方必须向业务侧提供的能力与语义。

### DD-6.1 必须具备的控制能力

- 按站点前往：输入站点 ID 或目标点，开始移动
- 取消移动：可被随时取消（尤其在“打断/急停/人工介入”场景）
- 状态查询：可查询当前状态与目标站点

### DD-6.2 状态语义

移动状态至少包含：
- `idle`：空闲
- `moving`：移动中
- `arrived`：已到站
- `failed`：失败（含不可达/超时/障碍持续阻塞）
- `cancelled`：已取消
- `estop`：急停触发

失败必须提供原因（至少可区分：不可达/超时/急停/障碍阻塞），便于运维定位。

### DD-6.3 到站标准与超时

- 到站标准以底盘给出的到站状态为准。
- 每次移动应有超时机制（由第三方或业务侧配置），超时进入失败并停止移动。

## DD-7 安全策略与人机提示（对应 SR-4）

### DD-7.1 物理急停

- 必须具备物理急停按钮（E‑Stop），急停触发后底盘立即停止并进入锁定状态。
- 急停解除后的恢复流程需明确（例如：人工复位→系统回到空闲→允许重新发起移动）。

### DD-7.2 室内限速与避障

- 室内运行需限速/限加速度；通道窄或人群密集可降速。
- 避障/防撞为底盘必须能力；在障碍持续阻塞时应停止并上报失败，避免“顶着不走”。

### DD-7.3 指示灯/小屏提示规范

至少支持以下状态提示（灯色/文案由第三方实现）：
- 移动中
- 讲解中
- 听取中（录音/识别中）
- 异常（移动失败/外部服务不可用/急停）

## DD-8 计算与运行环境（对应 SR-7）

- 工控机需支持开机自启（Windows 服务或 systemd 任选），并提供配置与操作手册。
- 建议提供“一键检查脚本/工具”，输出：CPU/内存/磁盘、网络连通、音频设备识别、底盘连通状态。

## DD-9 音频链路设计（对应 SR-5/SR-6）

### DD-9.1 语音输入链路

- 麦克风采集应稳定，建议 AEC/降噪；采样率统一到 16k mono（或能稳定转换）。
- 第三方需保证硬件与系统权限支持软件侧完成录音/识别/打断，以及“手动输入兜底”的操作路径。

### DD-9.2 语音输出链路

- 扬声器音量满足现场；避免明显失真、破音、底噪。
- 播放需要支持快速中断；第三方需确保音频设备与驱动在高频启停时稳定（不崩溃/不白噪音）。

## DD-10 运维、日志与数据（对应 SR-11/SR-13）

### DD-10.1 状态可视与导出

- 运行状态需可查看并可导出（例如：最近 N 次会话/任务的关键事件与耗时；具体字段与接口由软件文档定义）。
- 日志需包含：会话/任务标识、站点、移动目标、取消原因、失败原因；便于复盘现场问题。

### DD-10.2 数据最小化与清理

- 默认不保存原始音频；仅保存必要的文本、时间戳、请求标识与少量运行日志。
- 提供日志与历史的清理机制（按天数或容量），并在交付文档中写明默认策略。

## DD-11 容错与降级实现要求（对应 SR-12/SR-10/SR-1）

- 外部服务不可用时，系统需具备离线讲解资源包（预录音音频文件与清单/索引），确保软件侧可启用离线讲解，保证基本参观流程不中断。
- 可选/后续：本地脚本文本兜底资源（按站点准备简短讲解文本）。
- 移动失败时停止并提示人工协助；不得进入“假到站讲解”。

## DD-12 交付与验收（对应 SR-14）

### DD-12.1 第三方交付物清单

- BOM 清单（含型号/数量/参数/供应信息）与接线图
- 结构与工业设计交付物：结构件 BOM（材质/规格/数量）、安装位示意图（或照片）、线束走线图、维护拆装步骤（含工具清单）
- 站点清单与标定步骤（含导出/备份方法）
- 开机自启与部署手册（含常见故障排查）
- 维护手册（急停、充电、人工接管、恢复流程）
- 离线讲解资源包（预录音音频文件与清单/索引），保证外部服务不可用时仍可按站点讲解
- 现场验收检查表（可打印执行）

### DD-12.2 现场验收最小集

- 站点到达：从任意站点到任意站点可达（抽测 ≥3 个站点往返），到站判定稳定
- 打断：在移动/播报过程中触发打断，移动与播报均能停止并可恢复
- 降级：断开外部服务后，离线讲解资源包可用，可触发离线讲解并可停止/退出
- 安全：急停有效；解除急停后可按流程恢复
- 结构与工业设计：边角与防护检查、线束固定检查、急停可达性检查、一次“拆装维护演练”（按文档完成开盖与复位）

## DD-13 实施计划与人力投入（对应 SR-15）

> 目的：给预算与排期提供“可解释”的依据。人力按人月估算，实际以现场站点数量、底盘接口成熟度、外部服务部署方式为准。
> 总人力投入控制在 8 人月以内。

### DD-13.1 阶段划分

| 阶段 | 覆盖的 DD 条目 | 主要工作内容 | 主要交付物 | 建议人月（合计） |
|---|---|---|---|---:|
| P1 方案确认与踏勘 | DD-1、DD-4、DD-5 | 场地踏勘、站点初稿、网络/供电方案、风险点确认 | 场地信息与站点清单初稿、实施计划、风险清单 | 0.5 |
| P2 硬件选型与集成 | DD-2、DD-3、DD-4、DD-7、DD-9 | 底盘/音频/主机选型采购、工业设计与结构上装、安装布线、急停/指示灯接入、基础联通 | BOM、接线图、结构安装完成 | 2.5 |
| P3 站点标定与移动闭环 | DD-5、DD-6、DD-7 | 站点标定、到站标准确认、移动状态语义对齐、失败场景处理 | 站点标定文档、到站验证记录、移动闭环可用 | 2.0 |
| P4 音频与现场体验调优 | DD-9、DD-7 | 麦克风/扬声器位置调整、回声/啸叫排查、打断稳定性验证 | 音频调试记录、体验优化清单 | 1.0 |
| P5 运维与验收交付 | DD-10、DD-11、DD-12、DD-8 | 日志/导出/清理策略落实、降级演练、验收测试与文档收口 | 运维手册、验收检查表、交付包 | 2.0 |
|  |  |  | **合计** | **8.0** |


