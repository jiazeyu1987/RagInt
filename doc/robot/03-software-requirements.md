# 软件需求（本项目范围）

## 1. 软件边界

本项目软件 = 前端（控制台/讲解UI/调试面板） + 后端（编排/状态/接口） + 对接（RAGFlow/ASR/TTS） + 数据（历史/配置/日志）。

## 2. 功能需求（FR）

### FR-1 连续讲解
- 支持“开始讲解/继续/下一站/上一站/跳站/重置”
- 支持路线配置（展厅顺序）与每站时长/目标字数
- 支持“承接语”策略：减少重复欢迎/过渡话术

### FR-2 观众问答（打断机制）
- 新问题提交即取消旧 request（前后端一致）
- 旧流程停止：RAG SSE 停止、TTS 生成与播放停止、ASR 中断
- 允许队列（多人模式）：普通/高优先级

### FR-3 语音输入（ASR）
- 默认中文最优 provider；支持至少 3 个 provider 以便对比与降级
- 语音输入结果写入输入框，不自动提交（由用户/主持人确认提交）

### FR-4 语音播报（TTS）
- 流式播放（边合成边播），避免白噪音与卡顿
- 支持关闭播报（仅文字）
- 支持 debug：首包延迟、chunk 统计、播放 underrun

### FR-5 运维与可观测性
- 后端提供 `/api/status?request_id=...`：返回关键阶段耗时与当前状态
- 前端调试面板展示：提交→RAG首段→TTS首包→播报完成

### FR-6 历史与复用
- SQLite 记录提问与回答；同问题计数聚合；点击历史可回填输入框

## 3. 非功能需求（NFR）
- NFR-1 延迟：首句播报尽可能 < 3s（现场网络允许时）
- NFR-2 稳定：长时间运行（>8h）不内存泄漏，不累积连接
- NFR-3 可维护：核心编排逻辑从巨型文件拆分为 manager/service/orchestrator
- NFR-4 可扩展：新增展区/脚本/ASR/TTS provider 不影响主流程

## 4. 数据需求
- 配置文件化（不依赖环境变量）：
  - RAGFlow endpoint、chat/agent 选择、TTS/ASR provider 参数、展厅路线与每站时长
- 日志：结构化、带 request_id/client_id/stopIndex/segment seq

